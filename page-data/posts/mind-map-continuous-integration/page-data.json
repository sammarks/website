{"componentChunkName":"component---src-templates-page-tsx","path":"/posts/mind-map-continuous-integration/","result":{"data":{"markdownRemark":{"parent":{"__typename":"File","relativePath":"posts/mind-map-continuous-integration.md","fields":{"gitLogLatestDate":"September 19, 2020"}},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"div","properties":{"className":["custom-block","block-point"]},"children":[{"type":"element","tagName":"div","properties":{"className":["custom-block-heading"]},"children":[{"type":"text","value":"What‚Äôs the point?"}]},{"type":"element","tagName":"div","properties":{"className":["custom-block-body"]},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Don‚Äôt try to keep your entire deployment procedure in your head, pulling it out of the depths of\nyour brain every time you want to deploy. Use a CI instead, and stop stressing over how to deploy\nyour service."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This post is going to be a little bit different. Gone are the days of ‚Äúhere‚Äôs a cool way to automate\na part of your workflow using some open source library I made,‚Äù in are the days of"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\nüåà¬† "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"philosophical discussions."}]},{"type":"text","value":" üåà"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For this philosophical discussion, we‚Äôll talk about releasing to production, inevitably on a Friday\nafternoon at 5pm because, let‚Äôs face it, you‚Äôre a rebel ü§ò"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I‚Äôm gonna walk us through an example, one that might be all-too-familiar. You have a fancy deploy\nscript inside your application‚Äôs repository to deploy the entire backend server cluster to\nproduction. Let‚Äôs say you‚Äôve been responsible and use infrastructure-as-code, so you don‚Äôt have to\ntry to connect to servers manually and copy / paste files over."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"On Friday at 5pm, you run that magical script and start fiddling with your lucky pen as you watch\nthe lines of potentially-devastating instructions scroll across the screen. Your pulse quickens as\nyou reach the end of the process, and üéâ ¬†it‚Äôs all deployed. You breathe a sigh of relief and\nget some celebratory Panda Express on the way home."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It‚Äôs only in the middle of your binge-watching session of the latest Bachelor episode when your\nphone rings in the middle of your 20th scoop of cookie dough. On the other end of the line is your\nswift reminder of the terrible grasp of reality."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Your entire production stack is down."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Okay, maybe not "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"that"}]},{"type":"text","value":" catastrophic, but at least an entire section of your application is throwing\nan error because, guess what, you forgot an environment variable when you were deploying your code.\nYou thought you were being secure and responsible by not storing the environment variable values in\na plain-text file in your repository, so you‚Äôve kept them all in a secure location on your computer,\nthe location of which is located up in your trusty noggin."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The problem with your trusty noggin: "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"it‚Äôs not so trusty."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Stop trying to store the entire StackOverflow archive in your head."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let‚Äôs talk about that. But first, let‚Äôs make sure we‚Äôve nailed the point home with another example."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You remember that After Effects extension you created back in fall ‚Äò18? It‚Äôs a simple one. It copies\nand pastes images inside and outside of After Effects, because for some strange reason the software\nlacks that functionality in the first place."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You released it and developed an entire deployment process at the time in order to package it up and\nget it to the store to share, and you were damn proud of this deployment process. But there‚Äôs one\nglaring thing wrong with that deployment process: "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"you didn‚Äôt write any of it down."}]},{"type":"text","value":" Don‚Äôt worry,\nyou think to yourself at the time, there‚Äôs no way you‚Äôll forget how to deploy this thing."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we‚Äôre in fall 2020. The extension has done well, and has worked for most. There are a few bugs\nthat have been reported in the last few months that desperately need fixing. You pop open that\ncodebase, fix the bugs, test it on your local machine and verify it all works. You‚Äôre ready for the\nrelease, and then you open the README."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://media.giphy.com/media/3oFzlXt9uTYFwrniPC/giphy.gif","alt":"https://media.giphy.com/media/3oFzlXt9uTYFwrniPC/giphy.gif"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yep, there‚Äôs nothing in there."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In your infinite wisdom at the time, you created all of these wonderful deployment scripts, "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"but\nyou didn‚Äôt write down how to use them, or what kind of environment variables are required to even\nget them to work."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Nice one."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can revisit our original statement."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Stop trying to store the entire StackOverflow archive in your head."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now let‚Äôs talk about Continuous Integration. It‚Äôs the service you have enabled that automatically\nruns your unit tests (because you‚Äôre responsible and write those) to make sure everything is\nworking. It‚Äôs that service that causes tension on GitHub as you wait for the results to come back,\nand developer rage when inevitably come back with a tiny linter error where you missed a space on\nline 45 of whatamidoing.js."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Personally, I would prefer my rage be induced by "},{"type":"element","tagName":"a","properties":{"href":"https://circleci.com/","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"CircleCI,"}]},{"type":"text","value":" but there are\nother providers out there."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"But CI does more than just run your unit tests and linters against your PRs."}]},{"type":"text","value":" Let‚Äôs revisit the\nour original statement. You think to yourself: "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"of course I know not to try and store the entire\nStackOverflow archive in my head. That‚Äôs impossible. And moreso, it‚Äôs just silly."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"So why are you trying to store your entire deployment pipeline in your head?"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If your project is reasonably sized, you can automate your deployments, and you might be deploying\noften or at points in the future where you don‚Äôt remember the flow, "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"it makes sense to use a CI\nservice to deploy your code."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yep, that‚Äôs it. That right there ‚òùÔ∏è would be the entire point of this article. I just thought I\nwould share."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"How I use CircleCI to deploy my code."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I actually have the backend and frontend components of each of the products I work on in a single\nmonorepo, "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"because I‚Äôm hip."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And really, having everything in one repository is actually pretty helpful when it comes to\nautomating your deployment! Even if all of my repositories had automated deployments with CI, I\nwould at least have to go to each one individually and run the command to create the tag that\ntriggers the deployment."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But I would either have to wait for the server to finish deploying before tagging the frontend\ncomponents and triggering their release, or I would have to furiously cancel the frontend deployment\nif something caused the server deployment to fail, lest I anger the users."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So, with those painful memories in the back of my head, I designed the deployment process for this\nmonorepo to solve for that."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"First, I use ‚Äúhold‚Äù steps inside the workflow to make sure everything is kosher before the actual\ndeployment begins."}]},{"type":"text","value":" The first part of the workflow builds the code, runs unit tests, runs the\nlinter, and generally tries to catch any glaring errors pretty early. Once that succeeds, the\nworkflow waits for my approval. I give each of the earlier steps a quick glance to make sure\neverything looks okay, and then give my final approval (luckily, CircleCI notes "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"who"}]},{"type":"text","value":" approved the\nworkflow, so if I completely break the production environment with my fix I didn‚Äôt test because ‚Äúit\ntotally has to work,‚Äù everyone knows)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Second, I design the workflow to deploy the frontend once the server deployment succeeds."}]},{"type":"text","value":" Once\nthat final approval happens, the deployment to the backend server begins. Once those steps complete\nsuccessfully, the deployment to the frontend environments begins. If anything goes wrong, the entire\nbuild fails and I‚Äôm notified of it to fix it. After everything turns green, I give the production\nenvironment a quick run-through to make sure everything turned out just spiffy and go get my\ncelebratory Panda Express."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And with that, I don‚Äôt have to worry about how to deploy the application to production or any\nupdates to my local machine causing minor variations in how the code is packaged and thus breaking\nthe entire production app. I can also completely abandon the project for three years, come back to\nit, and do a deployment to production without giving it a second thought."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By keeping all of my deployment information in a CI workflow, I‚Äôve freed up my brain space for\nthings that matter, like pushing new features, and I‚Äôve eliminated an all-too-common source of human\nerror."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And by the way, "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"if the examples given in this post seem a little bit too realistic to be made up,\nit‚Äôs because they‚Äôre not (except maybe the Bachelor reference)."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["custom-block","block-success"]},"children":[{"type":"element","tagName":"div","properties":{"className":["custom-block-heading"]},"children":[{"type":"element","tagName":"icon-success","properties":{},"children":[{"type":"text","value":"Stop trying to remember how to deploy your application."}]}]},{"type":"element","tagName":"div","properties":{"className":["custom-block-body"]},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"At the end of the day, treat your deployment process like you‚Äôd treat a resource like\nStackOverflow. Don‚Äôt keep the entire thing in your head. If you do, you‚Äôll likely end up\nforgetting things and implementing processes improperly. If the process can be automated,\n"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"automate it and forget it."}]}]}]}]}],"data":{"quirksMode":false}},"fields":{"slug":"/posts/mind-map-continuous-integration/","socialImagePath":"/meta-images/posts/mind-map-continuous-integration.png"},"frontmatter":{"title":"Mind Map and Continuous Integration","summary":"Stop trying to remember how to deploy your service. Let the CI do it, and free up your brain space for more important things.","date":"2020-09-16"}}},"pageContext":{"slug":"/posts/mind-map-continuous-integration/"}}}